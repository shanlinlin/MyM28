/*===========================================================================+
|  Function : Utilities	                                                     |
|  Task     : Utilities                                                      |
|----------------------------------------------------------------------------|
|  Compile  : CCS3.1 -                                                   	 |
|  Link     : CCS3.1 -                                                   	 |
|  Call     :                                                                |
|----------------------------------------------------------------------------|
|  Author   : Winston.Yu                                                     |
|  Version  : V1.00                                                          |
|  Creation : 12/19/2008                                                     |
|  Revision :                                                          	     |
|                                                     						 |
|             							                                     |
+===========================================================================*/
#include "utils.h"

/*===========================================================================+
|           Constant                                                         |
+===========================================================================*/

/*===========================================================================+
|           Macro definition                                                 |
+===========================================================================*/

/*===========================================================================+
|           Global variable                                                  |
+===========================================================================*/

/*---------------------------------------------------------------------------+
|           Operations                                                       |
+---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------+
|  Function :                                                                |
|  Task     :                                                                |
+----------------------------------------------------------------------------+
|  Call     :                                                                |
|                                                                            |
|  Parameter:                           -                                    |
|                                                                            |
|  Return   :                           -                                    |
+---------------------------------------------------------------------------*/
long HexToL(char * pcStr)
{
	int  i    = 0;
	long lNum = 0;

	if ((pcStr[0] == '0' && pcStr[1] == 'x') || (pcStr[0] == '-' && pcStr[1] == '0' && pcStr[2] == 'x'))
	{
		i = 2;
		if (pcStr[0] == '-')
			i++;
		while (pcStr[i] != 0x0)
		{
			lNum = lNum * 16;
			if (pcStr[i] >= 'a' && pcStr[i] <= 'f')
				lNum = lNum + pcStr[i] - 'a' + 10;
			else if (pcStr[i] >= '0' && pcStr[i] <= '9')
				lNum = lNum + pcStr[i] - '0';
			else
			{
				lNum = 0;
				return lNum;
			}
			i++;
		}
	}
	if (pcStr[0] == '-')
		lNum = -lNum;
	return lNum;
}

/*---------------------------------------------------------------------------+
|           Operations                                                       |
+---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------+
|  Function :                                                                |
|  Task     :                                                                |
+----------------------------------------------------------------------------+
|  Call     :                                                                |
|                                                                            |
|  Parameter:                           -                                    |
|                                                                            |
|  Return   :                           -                                    |
+---------------------------------------------------------------------------*/
void CalcCPULoadEnd(CPULOAD * CPULoad)
{
	CPULoad->dwEndCounter = ReadCalcLoadCpuTimerCounter();
	if (CPULoad->dwStartCounter >= CPULoad->dwEndCounter)
		CPULoad->dwCurrentCounter = CPULoad->dwStartCounter - CPULoad->dwEndCounter;
	else
		CPULoad->dwCurrentCounter = 0xFFFFFFFF - CPULoad->dwEndCounter + CPULoad->dwStartCounter;
	if (CPULoad->dwCurrentCounter > CPULoad->dwMaxCounter)
		CPULoad->dwMaxCounter = CPULoad->dwCurrentCounter;
}
